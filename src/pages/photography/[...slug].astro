---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getImagesFromDirectory } from '../../lib/images';

export async function getStaticPaths() {
  const posts = await getCollection('photography');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const images = getImagesFromDirectory(post.data.img_dir);

const title = `Photography - ${post.data.title}`;
const description = `Photography - ${post.data.title}`;
---

<BaseLayout title={title} description={description}>
  <article>
    <h1 class="text-2xl md:text-3xl font-bold mb-6 leading-none">{post.data.title}</h1>
    {post.data.excerpt && <p class="leading-relaxed mb-4">{post.data.excerpt}</p>}

    <ul class="my-6 p-0">
      {images.map((image, idx) => (
        <li class="list-none mb-8">
          <img
            src={image.src}
            alt={`${post.data.title} - Image ${idx + 1}`}
            class="w-full h-auto"
            loading={idx === 0 ? 'eager' : 'lazy'}
          />
        </li>
      ))}
    </ul>
  </article>

  <aside>
    <a href="/photography" class="inline-block mt-32">
      &larr; photos
    </a>
  </aside>
</BaseLayout>
